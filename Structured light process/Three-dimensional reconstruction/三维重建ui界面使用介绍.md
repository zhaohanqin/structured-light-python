# 结构光三维重建工具

这是一个基于Python和PySide6的图形用户界面（GUI）应用程序，用于从结构光扫描数据中进行三维重建。本工具提供了一个直观的界面，用于加载所有必要的参数和数据，执行重建过程，并可视化中间结果和最终的三维模型。

## 功能特性

- **图形化参数输入**：通过友好的界面加载相机参数、投影仪参数、外参和相位数据。
- **实时进度反馈**：通过进度条和状态消息实时显示重建过程。
- **参数可配置**：支持自定义掩码生成的百分位和选择是否创建网格。
- **多阶段可视化**：
  - 显示解包裹的X和Y方向相位图。
  - 显示生成的有效数据区域掩码（Mask）。
  - 在独立的Open3D窗口中交互式查看生成的三维点云。
  - 在独立的Open3D窗口中交互式查看最终的三维网格模型。
- **结果导出**：自动将生成的点云（.ply格式）和网格（.ply格式）保存到指定的输出目录。
- **现代化UI**：使用自定义样式和控件，提供美观且响应迅速的用户体验。

## 界面概览

![UI截图](placeholder.png)  <!-- 建议在此处替换为真实的UI截图 -->

UI分为左右两个主要区域：

### 左侧面板：控制与参数

1. **3D重建标题**：应用程序的标题。
2. **输入参数卡片**：
    - **相机参数**：加载相机内参矩阵文件（`.npy`或`.json`）。
    - **投影仪参数**：加载投影仪内参矩阵及分辨率文件（`.json`或`.npy`）。
    - **外参**：加载相机与投影仪之间的旋转和平移矩阵文件（`.npy`或`.json`）。
    - **X/Y方向相位**：加载解包裹后的水平和垂直相位图文件（`.npy`或图像文件如`.png`, `.tiff`等）。
    - **输出目录**：指定一个文件夹用于保存重建结果。
3. **选项区域**：
    - **掩码百分位**：设置用于生成掩码的阈值，用于过滤掉低质量的相位数据。
    - **从点云创建网格**：勾选此项后，程序会在生成点云后进一步创建三维网格。
4. **操作与状态**：
    - **重建3D场景按钮**：点击此按钮开始三维重建流程。
    - **进度条**：在重建过程中显示当前进度。
    - **状态卡片**：显示当前的程序状态，如"就绪"、"正在加载参数..."、"重建完成"等。

### 右侧面板：可视化

此区域使用标签页来展示重建过程中的不同数据。

1. **解包裹相位**：重建开始后，此处会显示已加载的相位数据信息。
2. **掩码**：显示根据相位数据和设定的百分位生成的掩码信息。
3. **点云**：点云生成后，此标签页会显示结果保存的路径，并提供一个"查看点云"按钮，点击后会启动一个Open3D窗口来显示三维点云。
4. **网格**：如果勾选了创建网格选项，此标签页会显示网格保存的路径，并提供一个"查看网格"按钮，用于在Open3D中显示三维网格。

## 使用指南

### 1. 依赖安装

确保您已安装Python环境，然后通过pip安装以下库：

```bash
pip install numpy opencv-python open3d PySide6 matplotlib
```

### 2. 运行程序

在项目根目录下，通过以下命令启动应用程序：

```bash
python structured_light_ui.py
```

### 3. 操作步骤

1. **启动应用**：运行上述命令打开UI窗口。
2. **加载文件**：在左侧面板中，依次点击每个输入字段旁的"浏览"按钮，选择对应的参数和数据文件。
3. **配置选项**：
    - 根据需要调整"掩码百分位"的数值。
    - 如果需要生成网格模型，请确保"从点云创建网格"复选框被选中。
4. **指定输出**：选择或创建一个用于存放重建结果的输出目录。
5. **开始重建**：点击"重建3D场景"按钮。程序将开始执行，按钮会暂时禁用以防重复点击。
6. **监控进度**：观察状态栏的提示信息和进度条的变化。
7. **查看结果**：
    - 重建完成后，右侧的"点云"和"网格"标签页会更新。
    - 点击"查看点云"或"查看网格"按钮，即可在交互式3D窗口中查看模型。
    - 最终的`.ply`文件也会保存在您指定的输出目录中。

## 文件说明

### 输入文件

- **相机参数 (`.json`或`.npy`)**: 包含3x3的相机内参矩阵 `K`。
- **投影仪参数 (`.json`或`.npy`)**: 包含3x3的投影仪内参矩阵 `K_proj` 以及投影仪的分辨率（宽度和高度）。
- **外参 (`.json`或`.npy`)**: 包含3x3的旋转矩阵 `R` 和3x1的平移向量 `T`。
- **相位数据 (`.npy`或图像文件)**: 两个与相机分辨率相同的NumPy数组或图像文件（如`.png`, `.tiff`），分别代表X和Y方向的绝对相位值。

### 输出文件

- **`reconstructed_pointcloud.ply`**: 生成的三维点云文件，可被大多数三维软件（如MeshLab, CloudCompare）查看。
- **`reconstructed_mesh.ply`**: (可选) 从点云生成的三角网格模型。

## 技术栈

- **GUI框架**: [PySide6](https://www.qt.io/qt-for-python)
- **数值计算**: [NumPy](https://numpy.org/)
- **三维数据处理与可视化**: [Open3D](http://www.open3d.org/)
- **图像与数据IO**: [OpenCV-Python](https://pypi.org/project/opencv-python/) (通过`three-dimensional reconstruction`模块间接使用)
