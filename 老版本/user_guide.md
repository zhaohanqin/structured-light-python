# 结构光3D扫描系统使用指南

## 项目概述

本项目是一个基于结构光（条纹投影）的3D扫描系统，通过投影特定模式的条纹并使用相机捕获图像，可以重建物体的三维结构。系统采用相移轮廓术（Phase Shifting Profilometry，PSP）方法，适用于高精度3D重建应用。

## 硬件要求

- 投影仪（用于投影条纹图案）
- 相机（支持以下类型）：
  - 普通网络摄像头
  - Baumer工业相机（需要neoapi支持）
  - 也可使用模拟相机进行测试
- 稳定的支架（固定相机和投影仪）
- 校准板（理想情况下为黑白棋盘格）
- 计算机（运行Python环境）

## 软件环境设置

1. 确保已安装以下Python库：
   - OpenCV (cv2)
   - NumPy
   - SciPy
   - Matplotlib
   - 如使用Baumer相机，需安装neoapi

2. 克隆项目仓库到本地：

   ```bash
   git clone [项目仓库URL]
   cd structured-light-python
   ```

3. 安装依赖：

   ```bash
   pip install -r requirements.txt
   ```

## 系统使用流程

### 1. 硬件设置

1. **安装设备**：
   - 将投影仪和相机固定在稳定支架上
   - 确保投影仪和相机都能完全"看到"目标扫描区域
   - 投影仪与目标物体之间保持适当距离，确保图案清晰投影
   - 相机角度应与投影仪有一定夹角（通常15-45度），以便捕获条纹变形

2. **连接设备**：
   - 将相机连接到计算机
   - 连接投影仪并设置为扩展显示模式

### 2. 系统初始化与配置

1. **启动系统**：

   ```bash
   python main.py
   ```

2. **选择相机类型**：
   - 在`config.py`中设置`CAMERA_TYPE`为`'web'`、`'baumer'`或`'simulated'`
   - 系统会自动搜索并初始化相机

3. **检查相机连接**：
   - 程序启动后会显示已连接的相机数量
   - 确保显示正确的相机数量（通常为2个）

### 3. 相机调整（选项1）

1. **选择功能1 - 调整相机参数**

2. **调整网络摄像头**：
   - 系统会显示相机捕获的图像
   - 调整焦距确保图像清晰
   - 调整曝光、对比度等参数
   - 按指示键完成调整

3. **调整Baumer工业相机**（如使用）：
   - 调整曝光时间（控制亮度）
   - 调整伽马值（控制对比度）
   - 调整增益（控制灵敏度）
   - 所有参数会自动保存到配置文件

> **注意**：相机调整是获得高质量扫描结果的关键步骤。确保图像清晰、对比度适中，且无过度曝光区域。

### 4. 投影仪伽马校正（选项2）

1. **选择功能2 - 投影仪伽马校正校准**

2. **校准过程**：
   - 系统会投影不同强度的图案
   - 相机捕获这些图案
   - 分析强度-亮度关系
   - 计算伽马校正参数

3. **结果验证**：
   - 系统会显示校正前后的强度-亮度曲线
   - 理想情况下，校正后曲线应接近线性

> **重要**：伽马校正确保投影图案的线性响应，对于相位解包裹和3D重建精度至关重要。

### 5. 检查亮度分布（选项3）

1. **选择功能3 - 检查亮度分布**

2. **检查过程**：
   - 系统投影测试图案
   - 捕获并分析亮度分布
   - 显示亮度均匀性数据

> **提示**：此步骤可帮助识别投影或捕获中的问题，如热点、阴影或不均匀照明。

### 6. 执行3D扫描测量（选项4）

1. **准备工作**：
   - 放置要扫描的物体在视野中心
   - 确保物体表面适合结构光扫描（避免高反光、透明或黑色表面）
   - 保持环境光线稳定（最好在暗室中操作）

2. **选择功能4 - 执行测量**

3. **扫描过程**：
   - 系统自动投影一系列条纹图案（垂直和水平）
   - 相机捕获每个图案的图像
   - 实时显示捕获图像
   - 数据自动保存（如已启用）

4. **数据处理**：
   - 捕获完成后，系统自动使用相移法处理图像
   - 生成相位图和3D点云
   - 显示重建结果

> **关键**：扫描过程中，确保物体和设备保持绝对静止。任何移动都会导致重建错误。

## 数据输出与保存

1. **测量数据**：
   - 默认保存在`config.DATA_PATH`指定的目录
   - 每次测量创建以时间戳命名的文件夹
   - 包含原始图像和测量参数JSON文件

2. **3D点云**：
   - 处理后生成的点云可保存为常见格式（如PLY、OBJ）
   - 可在支持的3D查看软件中打开（如MeshLab、CloudCompare）

## 常见问题与解决方案

1. **相机无法检测**：
   - 检查USB连接
   - 确认相机驱动已正确安装
   - 尝试在设备管理器中禁用再启用相机

2. **投影图案不清晰**：
   - 调整投影仪焦距
   - 确保投影距离适当
   - 检查投影表面是否平整

3. **3D重建质量差**：
   - 重新进行相机调整和投影仪校准
   - 改善环境光控制
   - 考虑对物体表面进行处理（如喷涂白色粉末）

4. **系统崩溃或错误**：
   - 检查日志信息
   - 确认相机和投影仪连接稳定
   - 重启系统和设备

## 高级功能

系统还支持多种高级功能，可通过修改`config.py`文件或调用相关API实现：

- 多频率相移法（提高解包裹精度）
- 自适应曝光控制
- 自定义条纹频率和相移步数
- 点云后处理和网格生成

## 技术支持

如遇到无法解决的问题，请联系项目维护者或查阅以下资源：

- 项目文档
- 代码注释
- 相关论文与参考文献
